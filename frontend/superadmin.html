<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BetterDoctor - Administraci√≥n</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Sistema de dise√±o BetterDoctor v2.0 */
            --primary: #0891b2;
            --primary-dark: #0e7490;
            --primary-light: #22d3ee;
            --primary-bg: #ecfeff;
            --secondary: #10b981;
            --secondary-dark: #059669;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --purple: #8b5cf6;
            --pink: #ec4899;
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--gray-100);
            color: var(--gray-900);
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 0.85rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(8, 145, 178, 0.25);
        }
        
        .header h1 { 
            font-size: 1.35rem; 
            display: flex; 
            align-items: center; 
            gap: 0.5rem; 
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .header-nav { display: flex; gap: 0.5rem; align-items: center; }
        .header-nav a, .header-nav button {
            color: white;
            text-decoration: none;
            padding: 0.55rem 1rem;
            border-radius: 10px;
            font-size: 0.85rem;
            background: rgba(255,255,255,0.15);
            border: 1px solid rgba(255,255,255,0.2);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            backdrop-filter: blur(10px);
        }
        .header-nav a:hover, .header-nav button:hover { 
            background: rgba(255,255,255,0.25); 
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        /* Layout */
        .app-container {
            display: flex;
            padding-top: 56px;
            min-height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            width: 240px;
            background: white;
            border-right: 1px solid var(--gray-200);
            position: fixed;
            top: 56px;
            left: 0;
            bottom: 0;
            overflow-y: auto;
            padding: 1rem 0;
        }
        
        .sidebar-section {
            padding: 0 0.75rem;
            margin-bottom: 1.5rem;
        }
        
        .sidebar-title {
            font-size: 0.7rem;
            text-transform: uppercase;
            color: var(--gray-500);
            font-weight: 600;
            padding: 0 0.75rem;
            margin-bottom: 0.5rem;
            letter-spacing: 0.5px;
        }
        
        .sidebar-menu { list-style: none; }
        .sidebar-menu li { margin-bottom: 3px; }
        .sidebar-menu button {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.7rem 0.85rem;
            border-radius: 10px;
            text-decoration: none;
            color: var(--gray-700);
            font-size: 0.875rem;
            width: 100%;
            border: none;
            background: none;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
        }
        .sidebar-menu button:hover { 
            background: linear-gradient(135deg, var(--gray-100) 0%, var(--gray-50) 100%); 
            color: var(--primary); 
            transform: translateX(4px);
        }
        .sidebar-menu button.active { 
            background: linear-gradient(135deg, var(--primary) 0%, var(--purple) 100%); 
            color: white; 
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
        }
        .sidebar-menu button.active:hover { transform: none; }
        .sidebar-menu button .icon { font-size: 1.15rem; }
        .sidebar-menu .badge {
            margin-left: auto;
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
            color: white;
            font-size: 0.65rem;
            padding: 3px 8px;
            border-radius: 12px;
            font-weight: 700;
            box-shadow: 0 2px 6px rgba(239, 68, 68, 0.3);
        }
        
        /* Content */
        .main-content {
            flex: 1;
            margin-left: 240px;
            padding: 1.5rem;
            min-height: calc(100vh - 56px);
        }
        
        /* Page Header */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .page-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-900);
        }
        
        /* KPI Cards */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .kpi-card {
            background: white;
            border-radius: 16px;
            padding: 1.25rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            display: flex;
            align-items: center;
            gap: 1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary) 0%, var(--purple) 100%);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .kpi-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
            border-color: var(--primary);
        }
        
        .kpi-card:hover::before { opacity: 1; }
        
        .kpi-card:active { transform: translateY(-2px); }
        
        .kpi-icon {
            width: 56px;
            height: 56px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            transition: transform 0.3s;
        }
        
        .kpi-card:hover .kpi-icon { transform: scale(1.1); }
        
        .kpi-icon.blue { background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); }
        .kpi-icon.green { background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); }
        .kpi-icon.yellow { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); }
        .kpi-icon.red { background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); }
        .kpi-icon.purple { background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%); }
        .kpi-icon.pink { background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%); }
        
        .kpi-info h3 { font-size: 1.85rem; font-weight: 700; line-height: 1; color: var(--gray-900); }
        .kpi-info p { color: var(--gray-500); font-size: 0.8rem; margin-top: 0.25rem; font-weight: 500; }
        .kpi-trend { font-size: 0.75rem; margin-top: 0.25rem; font-weight: 600; }
        .kpi-trend.up { color: var(--success); }
        .kpi-trend.down { color: var(--danger); }
        
        .kpi-card .arrow { 
            position: absolute; 
            right: 1rem; 
            top: 50%; 
            transform: translateY(-50%); 
            opacity: 0; 
            transition: all 0.3s;
            color: var(--primary);
            font-size: 1.25rem;
        }
        .kpi-card:hover .arrow { opacity: 1; right: 0.75rem; }
        
        /* Cards */
        .card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            margin-bottom: 1.5rem;
            border: 1px solid var(--gray-100);
            transition: all 0.3s;
        }
        
        .card:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.25rem;
            border-bottom: 1px solid var(--gray-100);
            background: var(--gray-50);
            border-radius: 16px 16px 0 0;
        }
        
        .card-title { font-size: 1rem; font-weight: 600; display: flex; align-items: center; gap: 0.5rem; }
        .card-body { padding: 1.25rem; }
        
        /* Tables */
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 0.75rem 1rem; text-align: left; border-bottom: 1px solid var(--gray-100); }
        th { background: var(--gray-50); font-weight: 600; font-size: 0.75rem; text-transform: uppercase; color: var(--gray-500); }
        tr:hover { background: var(--gray-50); }
        
        /* Badges */
        .badge {
            display: inline-block;
            padding: 0.3rem 0.75rem;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
            letter-spacing: 0.3px;
            text-transform: uppercase;
        }
        .badge-success { background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); color: #065f46; }
        .badge-warning { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); color: #92400e; }
        .badge-danger { background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); color: #991b1b; }
        .badge-info { background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); color: #1e40af; }
        .badge-purple { background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%); color: #5b21b6; }
        
        /* List Items */
        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--gray-100);
            transition: all 0.2s;
        }
        .list-item:last-child { border-bottom: none; }
        .list-item:hover { background: var(--gray-50); margin: 0 -0.5rem; padding: 0.75rem 0.5rem; border-radius: 8px; }
        .list-item-info { display: flex; flex-direction: column; }
        .list-item-title { font-weight: 600; font-size: 0.9rem; }
        .list-item-subtitle { font-size: 0.8rem; color: var(--gray-500); }
        
        /* Buttons */
        .btn {
            padding: 0.6rem 1.25rem;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .btn:active { transform: translateY(0); }
        .btn-primary { background: linear-gradient(135deg, var(--primary) 0%, var(--purple) 100%); color: white; }
        .btn-primary:hover { background: linear-gradient(135deg, var(--primary-dark) 0%, #7c3aed 100%); }
        .btn-success { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; }
        .btn-success:hover { background: linear-gradient(135deg, #059669 0%, #047857 100%); }
        .btn-danger { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; }
        .btn-warning { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; }
        .btn-secondary { background: white; color: var(--gray-700); border: 2px solid var(--gray-200); box-shadow: none; }
        .btn-secondary:hover { background: var(--gray-50); border-color: var(--gray-300); }
        .btn-sm { padding: 0.4rem 0.85rem; font-size: 0.8rem; }
        
        /* Forms */
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; font-size: 0.875rem; }
        .form-control {
            width: 100%;
            padding: 0.6rem 0.75rem;
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            font-size: 0.9rem;
            transition: border-color 0.2s;
        }
        .form-control:focus { outline: none; border-color: var(--primary); }
        
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; }
        
        /* Search */
        .search-box {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        .search-box input {
            flex: 1;
            padding: 0.6rem 1rem;
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            font-size: 0.9rem;
        }
        
        /* Tabs */
        .tabs { display: flex; gap: 0.25rem; margin-bottom: 1rem; border-bottom: 2px solid var(--gray-200); }
        .tab {
            padding: 0.75rem 1.25rem;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 0.9rem;
            color: var(--gray-500);
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            transition: all 0.2s;
        }
        .tab:hover { color: var(--primary); }
        .tab.active { color: var(--primary); border-color: var(--primary); font-weight: 600; }
        
        /* Section visibility */
        .section { display: none; }
        .section.active { display: block; }
        
        /* Grid layouts */
        .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; }
        
        /* Stats mini cards */
        .stat-mini {
            background: var(--gray-50);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
        }
        .stat-mini h4 { font-size: 1.5rem; color: var(--primary); }
        .stat-mini p { font-size: 0.75rem; color: var(--gray-500); }
        
        /* Avatar */
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal-overlay.active { display: flex; }
        .modal {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-body { padding: 1.5rem; }
        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
        }
        .modal-close { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--gray-500); }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar { width: 200px; }
            .main-content { margin-left: 200px; }
            .grid-2 { grid-template-columns: 1fr; }
        }
        @media (max-width: 768px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; }
            .kpi-grid { grid-template-columns: repeat(2, 1fr); }
        }

        /* Timeline */
        .timeline { padding-left: 1.5rem; border-left: 2px solid var(--gray-200); }
        .timeline-item { position: relative; padding-bottom: 1.5rem; }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -1.65rem;
            top: 0;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--primary);
        }
        .timeline-item.success::before { background: var(--success); }
        .timeline-item.warning::before { background: var(--warning); }
        .timeline-time { font-size: 0.75rem; color: var(--gray-500); }
        .timeline-content { margin-top: 0.25rem; }

        /* Progress bar */
        .progress { height: 8px; background: var(--gray-200); border-radius: 4px; overflow: hidden; }
        .progress-bar { height: 100%; background: var(--primary); transition: width 0.3s; }
        .progress-bar.success { background: var(--success); }
        .progress-bar.warning { background: var(--warning); }
        .progress-bar.danger { background: var(--danger); }
    </style>
</head>
<body>
    <header class="header">
        <h1>üëë VetClinic - Super Admin</h1>
        <nav class="header-nav">
            <span id="fecha-hora"></span>
            <a href="index.html">ü©∫ Veterinario</a>
            <a href="recepcion.html">üìã Recepci√≥n</a>
            <a href="inventario.html">üì¶ Inventario</a>
            <button onclick="logout()">üö™ Salir</button>
        </nav>
    </header>
    
    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-title">Principal</div>
                <ul class="sidebar-menu">
                    <li><button class="active" onclick="showSection('dashboard')"><span class="icon">üìä</span> Dashboard</button></li>
                </ul>
            </div>
            
            <div class="sidebar-section">
                <div class="sidebar-title">Gesti√≥n Cl√≠nica</div>
                <ul class="sidebar-menu">
                    <li><button onclick="showSection('fichas')"><span class="icon">üêæ</span> Fichas<span class="badge" id="badge-pacientes">0</span></button></li>
                    <li><button onclick="showSection('tutores')"><span class="icon">üë•</span> Tutores</button></li>
                    <li><button onclick="showSection('agenda')"><span class="icon">üìÖ</span> Agenda</button></li>
                    <li><button onclick="showSection('consultas')"><span class="icon">ü©∫</span> Consultas</button></li>
                </ul>
            </div>
            
            <div class="sidebar-section">
                <div class="sidebar-title">Finanzas</div>
                <ul class="sidebar-menu">
                    <li><button onclick="showSection('pagos')"><span class="icon">üí∞</span> Pagos<span class="badge" id="badge-pendientes">0</span></button></li>
                    <li><button onclick="showSection('facturacion')"><span class="icon">üßæ</span> Facturaci√≥n</button></li>
                </ul>
            </div>
            
            <div class="sidebar-section">
                <div class="sidebar-title">Servicios</div>
                <ul class="sidebar-menu">
                    <li><button onclick="showSection('peluqueria')"><span class="icon">‚úÇÔ∏è</span> Peluquer√≠a</button></li>
                    <li><button onclick="showSection('hotel')"><span class="icon">üè®</span> Hotel</button></li>
                </ul>
            </div>
            
            <div class="sidebar-section">
                <div class="sidebar-title">Inventario</div>
                <ul class="sidebar-menu">
                    <li><button onclick="showSection('stock')"><span class="icon">üì¶</span> Stock<span class="badge" id="badge-alertas">0</span></button></li>
                </ul>
            </div>
            
            <div class="sidebar-section">
                <div class="sidebar-title">Sistema</div>
                <ul class="sidebar-menu">
                    <li><button onclick="showSection('usuarios')"><span class="icon">üë§</span> Usuarios</button></li>
                    <li><button onclick="showSection('reportes')"><span class="icon">üìà</span> Reportes</button></li>
                </ul>
            </div>
        </aside>
        
        <main class="main-content">
            <!-- DASHBOARD -->
            <section id="section-dashboard" class="section active">
                <div class="page-header">
                    <h2 class="page-title">Dashboard General</h2>
                    <div style="display: flex; gap: 0.5rem;">
                        <select class="form-control" style="width: auto;">
                            <option>Hoy</option>
                            <option>Esta semana</option>
                            <option selected>Este mes</option>
                            <option>Este a√±o</option>
                        </select>
                    </div>
                </div>
                
                <div class="kpi-grid">
                    <div class="kpi-card" onclick="showSection('fichas')">
                        <div class="kpi-icon blue">üêï</div>
                        <div class="kpi-info">
                            <h3 id="kpi-pacientes">0</h3>
                            <p>Pacientes Activos</p>
                            <span class="kpi-trend up">‚Üë 12% este mes</span>
                        </div>
                        <span class="arrow">‚Üí</span>
                    </div>
                    <div class="kpi-card" onclick="showSection('agenda')">
                        <div class="kpi-icon green">üìÖ</div>
                        <div class="kpi-info">
                            <h3 id="kpi-citas-hoy">0</h3>
                            <p>Citas Hoy</p>
                        </div>
                        <span class="arrow">‚Üí</span>
                    </div>
                    <div class="kpi-card" onclick="showSection('pagos')">
                        <div class="kpi-icon yellow">üí∞</div>
                        <div class="kpi-info">
                            <h3 id="kpi-ingresos">$0</h3>
                            <p>Ingresos del Mes</p>
                            <span class="kpi-trend up">‚Üë 8% vs mes anterior</span>
                        </div>
                        <span class="arrow">‚Üí</span>
                    </div>
                    <div class="kpi-card" onclick="showSection('pagos')">
                        <div class="kpi-icon red">‚è≥</div>
                        <div class="kpi-info">
                            <h3 id="kpi-pendientes">0</h3>
                            <p>Pagos Pendientes</p>
                        </div>
                        <span class="arrow">‚Üí</span>
                    </div>
                    <div class="kpi-card" onclick="showSection('peluqueria')">
                        <div class="kpi-icon purple">‚úÇÔ∏è</div>
                        <div class="kpi-info">
                            <h3 id="kpi-peluqueria">0</h3>
                            <p>Peluquer√≠a Hoy</p>
                        </div>
                        <span class="arrow">‚Üí</span>
                    </div>
                    <div class="kpi-card" onclick="showSection('stock')">
                        <div class="kpi-icon pink">‚ö†Ô∏è</div>
                        <div class="kpi-info">
                            <h3 id="kpi-alertas-stock">0</h3>
                            <p>Alertas Stock</p>
                        </div>
                        <span class="arrow">‚Üí</span>
                    </div>
                </div>
                
                <div class="grid-2">
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">üìã Pr√≥ximas Citas</span>
                            <button class="btn btn-sm btn-secondary" onclick="showSection('agenda')">Ver todas</button>
                        </div>
                        <div class="card-body">
                            <div id="proximas-citas">
                                <p style="color: var(--gray-500); text-align: center;">Cargando...</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">üí≥ Pagos Pendientes</span>
                            <button class="btn btn-sm btn-secondary" onclick="showSection('pagos')">Ver todos</button>
                        </div>
                        <div class="card-body">
                            <div id="pagos-pendientes-lista">
                                <p style="color: var(--gray-500); text-align: center;">Cargando...</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="grid-2">
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">üè• Actividad Reciente</span>
                        </div>
                        <div class="card-body">
                            <div class="timeline" id="actividad-reciente">
                                <div class="timeline-item success">
                                    <div class="timeline-time">Hace 5 min</div>
                                    <div class="timeline-content">Consulta completada - Max (Golden)</div>
                                </div>
                                <div class="timeline-item">
                                    <div class="timeline-time">Hace 15 min</div>
                                    <div class="timeline-content">Nuevo paciente registrado - Luna</div>
                                </div>
                                <div class="timeline-item warning">
                                    <div class="timeline-time">Hace 30 min</div>
                                    <div class="timeline-content">Pago recibido - $45.000</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">üì¶ Alertas de Stock</span>
                            <button class="btn btn-sm btn-secondary" onclick="showSection('stock')">Ver todo</button>
                        </div>
                        <div class="card-body">
                            <div id="alertas-stock-resumen">
                                <p style="color: var(--gray-500); text-align: center;">Cargando...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- FICHAS / PACIENTES -->
            <section id="section-fichas" class="section">
                <div class="page-header">
                    <h2 class="page-title">üêæ Fichas de Pacientes</h2>
                    <button class="btn btn-primary" onclick="abrirModalPaciente()">‚ûï Nuevo Paciente</button>
                </div>
                
                <div class="tabs">
                    <button class="tab active" onclick="showFichasTab('activos')">Activos</button>
                    <button class="tab" onclick="showFichasTab('todos')">Todos</button>
                    <button class="tab" onclick="showFichasTab('fallecidos')">Fallecidos üïäÔ∏è</button>
                </div>
                
                <div class="card">
                    <div class="card-body">
                        <div class="search-box">
                            <input type="text" id="buscar-paciente" placeholder="üîç Buscar por nombre, especie, tutor...">
                            <select id="filtro-especie">
                                <option value="">Todas las especies</option>
                                <option value="Perro">Perros</option>
                                <option value="Gato">Gatos</option>
                                <option value="Exotico">Ex√≥ticos</option>
                            </select>
                            <button class="btn btn-primary" onclick="buscarPacientes()">Buscar</button>
                        </div>
                        
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Paciente</th>
                                        <th>Especie/Raza</th>
                                        <th>Tutor</th>
                                        <th>Edad</th>
                                        <th>√öltima Visita</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="tabla-pacientes"></tbody>
                            </table>
                        </div>
                        <p id="info-pacientes" style="margin-top: 1rem; color: var(--gray-500); font-size: 0.85rem;"></p>
                    </div>
                </div>
            </section>
            
            <!-- TUTORES -->
            <section id="section-tutores" class="section">
                <div class="page-header">
                    <h2 class="page-title">üë• Tutores / Clientes</h2>
                    <button class="btn btn-primary" onclick="abrirModalTutor()">‚ûï Nuevo Tutor</button>
                </div>
                
                <div class="card">
                    <div class="card-body">
                        <div class="search-box">
                            <input type="text" id="buscar-tutor" placeholder="üîç Buscar por nombre, RUT, tel√©fono...">
                            <button class="btn btn-primary" onclick="buscarTutores()">Buscar</button>
                        </div>
                        
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Tutor</th>
                                        <th>RUT</th>
                                        <th>Tel√©fono</th>
                                        <th>Email</th>
                                        <th>Mascotas</th>
                                        <th>Saldo Pendiente</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="tabla-tutores"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- AGENDA -->
            <section id="section-agenda" class="section">
                <div class="page-header">
                    <h2 class="page-title">üìÖ Agenda de Citas</h2>
                    <button class="btn btn-primary" onclick="abrirModalCita()">‚ûï Nueva Cita</button>
                </div>
                
                <div class="tabs">
                    <button class="tab active" onclick="showAgendaTab('hoy')">Hoy</button>
                    <button class="tab" onclick="showAgendaTab('semana')">Esta Semana</button>
                    <button class="tab" onclick="showAgendaTab('historico')">Hist√≥rico</button>
                </div>
                
                <div class="card">
                    <div class="card-body">
                        <div class="search-box">
                            <input type="date" id="fecha-agenda" onchange="cargarAgenda()">
                            <select id="filtro-tipo-cita">
                                <option value="">Todos los tipos</option>
                                <option value="consulta">Consulta</option>
                                <option value="vacunacion">Vacunaci√≥n</option>
                                <option value="cirugia">Cirug√≠a</option>
                                <option value="control">Control</option>
                                <option value="peluqueria">Peluquer√≠a</option>
                            </select>
                            <button class="btn btn-primary" onclick="cargarAgenda()">Filtrar</button>
                        </div>
                        
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Hora</th>
                                        <th>Paciente</th>
                                        <th>Tutor</th>
                                        <th>Tipo</th>
                                        <th>Veterinario</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="tabla-agenda"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- CONSULTAS -->
            <section id="section-consultas" class="section">
                <div class="page-header">
                    <h2 class="page-title">ü©∫ Historial de Consultas</h2>
                </div>
                
                <div class="card">
                    <div class="card-body">
                        <div class="search-box">
                            <input type="text" id="buscar-consulta" placeholder="üîç Buscar por paciente, diagn√≥stico...">
                            <input type="date" id="fecha-desde">
                            <input type="date" id="fecha-hasta">
                            <button class="btn btn-primary" onclick="buscarConsultas()">Buscar</button>
                        </div>
                        
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Paciente</th>
                                        <th>Diagn√≥stico</th>
                                        <th>Veterinario</th>
                                        <th>Monto</th>
                                        <th>Estado Pago</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="tabla-consultas-historial"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- PAGOS -->
            <section id="section-pagos" class="section">
                <div class="page-header">
                    <h2 class="page-title">üí∞ Gesti√≥n de Pagos</h2>
                </div>
                
                <div class="kpi-grid" style="margin-bottom: 1.5rem;">
                    <div class="kpi-card">
                        <div class="kpi-icon green">‚úÖ</div>
                        <div class="kpi-info">
                            <h3 id="total-cobrado">$0</h3>
                            <p>Cobrado Este Mes</p>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon red">‚è≥</div>
                        <div class="kpi-info">
                            <h3 id="total-pendiente">$0</h3>
                            <p>Pendiente de Cobro</p>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon yellow">üìä</div>
                        <div class="kpi-info">
                            <h3 id="promedio-ticket">$0</h3>
                            <p>Ticket Promedio</p>
                        </div>
                    </div>
                </div>
                
                <div class="tabs">
                    <button class="tab active" onclick="showPagosTab('pendientes')">Pendientes</button>
                    <button class="tab" onclick="showPagosTab('realizados')">Realizados</button>
                    <button class="tab" onclick="showPagosTab('por-tutor')">Por Tutor</button>
                </div>
                
                <div class="card">
                    <div class="card-body">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Paciente</th>
                                        <th>Tutor</th>
                                        <th>Concepto</th>
                                        <th>Monto</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="tabla-pagos"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- FACTURACI√ìN -->
            <section id="section-facturacion" class="section">
                <div class="page-header">
                    <h2 class="page-title">üßæ Facturaci√≥n</h2>
                    <button class="btn btn-primary">üìÑ Generar Reporte</button>
                </div>
                <div class="card">
                    <div class="card-body">
                        <p style="color: var(--gray-500); text-align: center;">M√≥dulo de facturaci√≥n en desarrollo...</p>
                    </div>
                </div>
            </section>
            
            <!-- PELUQUER√çA -->
            <section id="section-peluqueria" class="section">
                <div class="page-header">
                    <h2 class="page-title">‚úÇÔ∏è Peluquer√≠a</h2>
                    <button class="btn btn-primary" onclick="abrirModalPeluqueria()">‚ûï Nueva Cita</button>
                </div>
                
                <div class="kpi-grid" style="grid-template-columns: repeat(4, 1fr);">
                    <div class="kpi-card">
                        <div class="kpi-icon purple">üìÖ</div>
                        <div class="kpi-info">
                            <h3 id="peluqueria-hoy">0</h3>
                            <p>Citas Hoy</p>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon green">‚úÖ</div>
                        <div class="kpi-info">
                            <h3 id="peluqueria-completadas">0</h3>
                            <p>Completadas</p>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon yellow">‚è≥</div>
                        <div class="kpi-info">
                            <h3 id="peluqueria-espera">0</h3>
                            <p>En Espera</p>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon blue">üí∞</div>
                        <div class="kpi-info">
                            <h3 id="peluqueria-ingresos">$0</h3>
                            <p>Ingresos Hoy</p>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Agenda de Peluquer√≠a - Hoy</span>
                        <input type="date" id="fecha-peluqueria" class="form-control" style="width: auto;">
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Hora</th>
                                        <th>Mascota</th>
                                        <th>Raza</th>
                                        <th>Tutor</th>
                                        <th>Servicios</th>
                                        <th>Precio</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="tabla-peluqueria"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- HOTEL -->
            <section id="section-hotel" class="section">
                <div class="page-header">
                    <h2 class="page-title">üè® Hotel de Mascotas</h2>
                </div>
                <div class="card">
                    <div class="card-body">
                        <p style="color: var(--gray-500); text-align: center;">M√≥dulo de hotel en desarrollo...</p>
                    </div>
                </div>
            </section>
            
            <!-- STOCK -->
            <section id="section-stock" class="section">
                <div class="page-header">
                    <h2 class="page-title">üì¶ Resumen de Inventario</h2>
                    <a href="inventario.html" class="btn btn-primary">Ir a Gesti√≥n Completa ‚Üí</a>
                </div>
                
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-icon red">üö´</div>
                        <div class="kpi-info">
                            <h3 id="stock-agotados">0</h3>
                            <p>Agotados</p>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon yellow">‚ö†Ô∏è</div>
                        <div class="kpi-info">
                            <h3 id="stock-bajo">0</h3>
                            <p>Stock Bajo</p>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon red">üìÖ</div>
                        <div class="kpi-info">
                            <h3 id="stock-vencidos">0</h3>
                            <p>Vencidos</p>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon yellow">‚è∞</div>
                        <div class="kpi-info">
                            <h3 id="stock-por-vencer">0</h3>
                            <p>Por Vencer</p>
                        </div>
                    </div>
                </div>
                
                <div class="grid-2">
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">üö® Productos Agotados</span>
                        </div>
                        <div class="card-body">
                            <div id="lista-agotados"></div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">‚è∞ Pr√≥ximos a Vencer</span>
                        </div>
                        <div class="card-body">
                            <div id="lista-por-vencer"></div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- USUARIOS -->
            <section id="section-usuarios" class="section">
                <div class="page-header">
                    <h2 class="page-title">üë§ Gesti√≥n de Usuarios</h2>
                    <button class="btn btn-primary">‚ûï Nuevo Usuario</button>
                </div>
                
                <div class="card">
                    <div class="card-body">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Usuario</th>
                                        <th>Nombre</th>
                                        <th>Rol</th>
                                        <th>Email</th>
                                        <th>√öltimo Acceso</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="tabla-usuarios"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- REPORTES -->
            <section id="section-reportes" class="section">
                <div class="page-header">
                    <h2 class="page-title">üìà Reportes y Estad√≠sticas</h2>
                </div>
                
                <div class="grid-3">
                    <div class="stat-mini">
                        <h4 id="rep-consultas-mes">0</h4>
                        <p>Consultas este mes</p>
                    </div>
                    <div class="stat-mini">
                        <h4 id="rep-nuevos-pacientes">0</h4>
                        <p>Nuevos pacientes</p>
                    </div>
                    <div class="stat-mini">
                        <h4 id="rep-vacunas">0</h4>
                        <p>Vacunas aplicadas</p>
                    </div>
                </div>
                
                <div class="card" style="margin-top: 1.5rem;">
                    <div class="card-header">
                        <span class="card-title">Generar Reportes</span>
                    </div>
                    <div class="card-body">
                        <div class="grid-3">
                            <button class="btn btn-secondary" style="padding: 1rem;">üìä Ingresos Mensuales</button>
                            <button class="btn btn-secondary" style="padding: 1rem;">üêæ Pacientes por Especie</button>
                            <button class="btn btn-secondary" style="padding: 1rem;">üíä Medicamentos m√°s Usados</button>
                            <button class="btn btn-secondary" style="padding: 1rem;">üë®‚Äç‚öïÔ∏è Consultas por Veterinario</button>
                            <button class="btn btn-secondary" style="padding: 1rem;">üìÖ Citas por D√≠a/Hora</button>
                            <button class="btn btn-secondary" style="padding: 1rem;">üí∞ Pagos Pendientes</button>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>
    
    <!-- Modal Paciente -->
    <div class="modal-overlay" id="modal-paciente">
        <div class="modal" style="max-width: 800px;">
            <div class="modal-header">
                <h3>üêæ Registrar Nuevo Paciente</h3>
                <button class="modal-close" onclick="cerrarModal('paciente')">&times;</button>
            </div>
            <div class="modal-body">
                <h4 style="color: var(--primary); margin-bottom: 1rem; font-size: 1rem;">Datos de la Mascota</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label>Nombre *</label>
                        <input type="text" class="form-control" id="pac-nombre" placeholder="Nombre de la mascota" required>
                    </div>
                    <div class="form-group">
                        <label>Especie *</label>
                        <select class="form-control" id="pac-especie" required onchange="cargarRazas()">
                            <option value="">Seleccionar...</option>
                            <option value="Perro">üêï Perro</option>
                            <option value="Gato">üêà Gato</option>
                            <option value="Conejo">üê∞ Conejo</option>
                            <option value="Ave">ü¶ú Ave</option>
                            <option value="Reptil">ü¶é Reptil</option>
                            <option value="Otro">Otro</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Raza</label>
                        <select class="form-control" id="pac-raza">
                            <option value="">Seleccione especie primero...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Sexo</label>
                        <select class="form-control" id="pac-sexo">
                            <option value="">Seleccionar...</option>
                            <option value="Macho">Macho</option>
                            <option value="Hembra">Hembra</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Fecha Nacimiento</label>
                        <input type="date" class="form-control" id="pac-nacimiento">
                    </div>
                    <div class="form-group">
                        <label>Color</label>
                        <input type="text" class="form-control" id="pac-color" placeholder="Color del pelaje">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Peso (kg)</label>
                        <input type="number" class="form-control" id="pac-peso" step="0.1" placeholder="Ej: 5.5">
                    </div>
                    <div class="form-group">
                        <label>Microchip</label>
                        <input type="text" class="form-control" id="pac-microchip" placeholder="N√∫mero de microchip">
                    </div>
                </div>
                <div class="form-group">
                    <label>Alergias / Observaciones</label>
                    <textarea class="form-control" id="pac-alergias" rows="2" placeholder="Alergias conocidas o condiciones especiales..."></textarea>
                </div>
                
                <h4 style="color: var(--primary); margin: 1.5rem 0 1rem; font-size: 1rem; padding-top: 1rem; border-top: 2px solid var(--gray-200);">Datos del Tutor</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label>Nombre Completo *</label>
                        <input type="text" class="form-control" id="tutor-nombre" placeholder="Nombre del due√±o" required>
                    </div>
                    <div class="form-group">
                        <label>RUT</label>
                        <input type="text" class="form-control" id="tutor-rut" placeholder="12.345.678-9">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Tel√©fono *</label>
                        <input type="tel" class="form-control" id="tutor-telefono" placeholder="+56 9 1234 5678" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" class="form-control" id="tutor-email" placeholder="correo@ejemplo.com">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Direcci√≥n</label>
                        <input type="text" class="form-control" id="tutor-direccion" placeholder="Calle y n√∫mero">
                    </div>
                    <div class="form-group">
                        <label>Comuna</label>
                        <input type="text" class="form-control" id="tutor-comuna" placeholder="Comuna">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="cerrarModal('paciente')">Cancelar</button>
                <button class="btn btn-primary" onclick="guardarPaciente()">üíæ Guardar Paciente</button>
            </div>
        </div>
    </div>
    
    <!-- Modal Cita Peluquer√≠a -->
    <div class="modal-overlay" id="modal-peluqueria">
        <div class="modal">
            <div class="modal-header">
                <h3>‚úÇÔ∏è Agendar Peluquer√≠a</h3>
                <button class="modal-close" onclick="cerrarModal('peluqueria')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label>Fecha *</label>
                        <input type="date" class="form-control" id="pelu-fecha">
                    </div>
                    <div class="form-group">
                        <label>Hora *</label>
                        <select class="form-control" id="pelu-hora">
                            <option value="09:00">09:00</option>
                            <option value="10:00">10:00</option>
                            <option value="11:00">11:00</option>
                            <option value="12:00">12:00</option>
                            <option value="14:00">14:00</option>
                            <option value="15:00">15:00</option>
                            <option value="16:00">16:00</option>
                            <option value="17:00">17:00</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Paciente *</label>
                    <select class="form-control" id="pelu-paciente">
                        <option value="">Seleccionar mascota...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Servicios *</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                        <label><input type="checkbox" value="bano"> Ba√±o</label>
                        <label><input type="checkbox" value="corte"> Corte</label>
                        <label><input type="checkbox" value="unas"> Corte de u√±as</label>
                        <label><input type="checkbox" value="oidos"> Limpieza o√≠dos</label>
                        <label><input type="checkbox" value="dientes"> Limpieza dental</label>
                    </div>
                </div>
                <div class="form-group">
                    <label>Notas</label>
                    <textarea class="form-control" id="pelu-notas" rows="2"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="cerrarModal('peluqueria')">Cancelar</button>
                <button class="btn btn-primary" onclick="guardarPeluqueria()">Agendar</button>
            </div>
        </div>
    </div>
    
    <script>
        const API_URL = 'http://localhost:5000';
        
        // Auth check
        const user = JSON.parse(localStorage.getItem('vetclinic_user') || 'null');
        if (!user || (user.rol !== 'administracion' && user.rol !== 'admin' && user.rol !== 'superadmin')) {
            alert('Acceso denegado. Solo administradores.');
            window.location.href = 'login.html';
        }
        
        // Fecha/hora en header
        function actualizarFechaHora() {
            const now = new Date();
            document.getElementById('fecha-hora').textContent = now.toLocaleDateString('es-CL', {
                weekday: 'short', day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit'
            });
        }
        actualizarFechaHora();
        setInterval(actualizarFechaHora, 60000);
        
        // Navigation
        function showSection(section) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById('section-' + section).classList.add('active');
            
            // Actualizar sidebar activo
            document.querySelectorAll('.sidebar-menu button').forEach(b => {
                b.classList.remove('active');
                if (b.textContent.toLowerCase().includes(section.substring(0, 4))) {
                    b.classList.add('active');
                }
            });
            
            // Cargar datos seg√∫n secci√≥n
            switch(section) {
                case 'dashboard': cargarDashboard(); break;
                case 'fichas': cargarPacientes(); break;
                case 'tutores': cargarTutores(); break;
                case 'agenda': cargarAgenda(); break;
                case 'consultas': cargarConsultasHistorial(); break;
                case 'pagos': cargarPagos(); break;
                case 'stock': cargarStock(); break;
                case 'peluqueria': cargarPeluqueria(); break;
                case 'usuarios': cargarUsuarios(); break;
                case 'reportes': cargarReportes(); break;
            }
        }
        
        // Cargar reportes
        async function cargarReportes() {
            try {
                const statsRes = await fetch(`${API_URL}/api/dashboard/estadisticas`);
                const stats = await statsRes.json();
                
                if (stats.exito) {
                    document.getElementById('rep-consultas-mes').textContent = stats.estadisticas.consultas_mes || 0;
                }
                
                // Pacientes nuevos este mes (simulado por ahora)
                document.getElementById('rep-nuevos-pacientes').textContent = Math.floor(Math.random() * 10) + 5;
                document.getElementById('rep-vacunas').textContent = Math.floor(Math.random() * 20) + 10;
            } catch (error) {
                console.error('Error:', error);
            }
        }
        
        // Dashboard
        async function cargarDashboard() {
            try {
                // Cargar estad√≠sticas reales
                const [pacientesRes, alertasRes, consultasRes, statsRes] = await Promise.all([
                    fetch(`${API_URL}/api/pacientes`),
                    fetch(`${API_URL}/api/admin/alertas-stock`),
                    fetch(`${API_URL}/api/consultas/por-cobrar`),
                    fetch(`${API_URL}/api/dashboard/estadisticas`)
                ]);
                
                const pacientes = await pacientesRes.json();
                const alertas = await alertasRes.json();
                const consultas = await consultasRes.json();
                const stats = await statsRes.json();
                
                // KPIs con datos reales
                document.getElementById('kpi-pacientes').textContent = pacientes.pacientes?.length || 0;
                document.getElementById('badge-pacientes').textContent = pacientes.pacientes?.length || 0;
                
                if (stats.exito) {
                    const s = stats.estadisticas;
                    document.getElementById('kpi-citas-hoy').textContent = s.citas_hoy || 0;
                    document.getElementById('kpi-ingresos').textContent = '$' + (s.ingresos_mes || 0).toLocaleString();
                    document.getElementById('kpi-peluqueria').textContent = s.peluqueria_hoy || 0;
                }
                
                document.getElementById('kpi-pendientes').textContent = consultas.consultas?.length || 0;
                document.getElementById('badge-pendientes').textContent = consultas.consultas?.length || 0;
                
                if (alertas.exito) {
                    const totalAlertas = alertas.alertas.resumen.agotados + alertas.alertas.resumen.stock_bajo;
                    document.getElementById('kpi-alertas-stock').textContent = totalAlertas;
                    document.getElementById('badge-alertas').textContent = totalAlertas;
                    
                    // Alertas stock resumen
                    const alertasHtml = alertas.alertas.agotados.slice(0, 5).map(p => `
                        <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--gray-100);">
                            <span>${p.nombre.substring(0, 30)}...</span>
                            <span class="badge badge-danger">Agotado</span>
                        </div>
                    `).join('') || '<p style="color: var(--gray-500);">Sin alertas</p>';
                    document.getElementById('alertas-stock-resumen').innerHTML = alertasHtml;
                }
                
                // Pagos pendientes
                const pagosHtml = (consultas.consultas || []).slice(0, 5).map(c => `
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--gray-100);">
                        <div>
                            <strong>${c.paciente?.nombre || 'Paciente'}</strong>
                            <br><small style="color: var(--gray-500);">${c.tutor?.nombre || 'Tutor'}</small>
                        </div>
                        <span style="color: var(--danger); font-weight: 600;">$${(c.total || 0).toLocaleString()}</span>
                    </div>
                `).join('') || '<p style="color: var(--gray-500);">Sin pagos pendientes</p>';
                document.getElementById('pagos-pendientes-lista').innerHTML = pagosHtml;
                
                // Pr√≥ximas citas (simulado)
                document.getElementById('proximas-citas').innerHTML = `
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--gray-100);">
                        <div><strong>10:00</strong> - Max (Consulta)</div>
                        <span class="badge badge-info">Confirmada</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--gray-100);">
                        <div><strong>11:30</strong> - Luna (Vacunaci√≥n)</div>
                        <span class="badge badge-warning">Pendiente</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--gray-100);">
                        <div><strong>12:00</strong> - Rocky (Control)</div>
                        <span class="badge badge-info">Confirmada</span>
                    </div>
                `;
                
            } catch (error) {
                console.error('Error cargando dashboard:', error);
            }
        }
        
        // Pacientes
        async function cargarPacientes() {
            try {
                const res = await fetch(`${API_URL}/api/pacientes`);
                const data = await res.json();
                
                if (data.exito) {
                    const tbody = document.getElementById('tabla-pacientes');
                    tbody.innerHTML = data.pacientes.map(p => `
                        <tr>
                            <td>
                                <div style="display: flex; align-items: center; gap: 0.75rem;">
                                    <div class="avatar" style="background: ${p.especie === 'Perro' ? '#dbeafe' : '#fce7f3'}">
                                        ${p.especie === 'Perro' ? 'üêï' : 'üêà'}
                                    </div>
                                    <div>
                                        <strong>${p.nombre}</strong>
                                        <br><small style="color: var(--gray-500);">ID: ${p.id}</small>
                                    </div>
                                </div>
                            </td>
                            <td>${p.especie}<br><small style="color: var(--gray-500);">${p.raza || 'Sin especificar'}</small></td>
                            <td>${p.tutor?.nombre || 'Sin tutor'}</td>
                            <td>${p.edad || 'N/A'}</td>
                            <td>${p.ultima_visita || 'Sin visitas'}</td>
                            <td><span class="badge ${p.fallecido ? 'badge-danger' : 'badge-success'}">${p.fallecido ? 'Fallecido' : 'Activo'}</span></td>
                            <td>
                                <button class="btn btn-sm btn-secondary" onclick="verFicha(${p.id})">üëÅÔ∏è Ver</button>
                            </td>
                        </tr>
                    `).join('') || '<tr><td colspan="7" style="text-align: center; color: var(--gray-500);">No hay pacientes</td></tr>';
                    
                    document.getElementById('info-pacientes').textContent = `Total: ${data.pacientes.length} pacientes`;
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }
        
        // Tutores
        async function cargarTutores() {
            try {
                const res = await fetch(`${API_URL}/api/pacientes`);
                const data = await res.json();
                
                // Agrupar por tutor
                const tutores = {};
                (data.pacientes || []).forEach(p => {
                    if (p.tutor) {
                        const key = p.tutor.nombre || 'Sin nombre';
                        if (!tutores[key]) {
                            tutores[key] = { ...p.tutor, mascotas: [] };
                        }
                        tutores[key].mascotas.push(p.nombre);
                    }
                });
                
                const tbody = document.getElementById('tabla-tutores');
                tbody.innerHTML = Object.values(tutores).map(t => `
                    <tr>
                        <td><strong>${t.nombre}</strong></td>
                        <td>${t.rut || 'Sin RUT'}</td>
                        <td>${t.telefono || 'Sin tel√©fono'}</td>
                        <td>${t.email || 'Sin email'}</td>
                        <td><span class="badge badge-info">${t.mascotas.length}</span> ${t.mascotas.join(', ')}</td>
                        <td><span style="color: var(--danger);">$0</span></td>
                        <td><button class="btn btn-sm btn-secondary">üëÅÔ∏è Ver</button></td>
                    </tr>
                `).join('') || '<tr><td colspan="7" style="text-align: center;">No hay tutores</td></tr>';
                
            } catch (error) {
                console.error('Error:', error);
            }
        }
        
        // Pagos
        async function cargarPagos() {
            try {
                // Cargar datos de pagos y estad√≠sticas en paralelo
                const [porCobrarRes, statsRes] = await Promise.all([
                    fetch(`${API_URL}/api/consultas/por-cobrar`),
                    fetch(`${API_URL}/api/dashboard/estadisticas`)
                ]);
                
                const data = await porCobrarRes.json();
                const stats = await statsRes.json();
                
                // Renderizar tabla de pagos pendientes
                const tbody = document.getElementById('tabla-pagos');
                tbody.innerHTML = (data.consultas || []).map(c => {
                    const fecha = c.fecha_registro ? new Date(c.fecha_registro).toLocaleDateString('es-CL') : 'N/A';
                    return `
                        <tr>
                            <td>${fecha}</td>
                            <td>${c.paciente?.nombre || 'Paciente'}</td>
                            <td>${c.paciente?.propietario || c.tutor?.nombre || 'Tutor'}</td>
                            <td>${c.diagnostico?.nombre || c.motivo_consulta || 'Consulta'}</td>
                            <td><strong>$${(c.cobro?.total || 0).toLocaleString()}</strong></td>
                            <td><span class="badge badge-warning">Pendiente</span></td>
                            <td>
                                <button class="btn btn-sm btn-success" onclick="cobrarConsulta(${c.id})">üí≥ Cobrar</button>
                            </td>
                        </tr>
                    `;
                }).join('') || '<tr><td colspan="7" style="text-align: center;">No hay pagos pendientes üéâ</td></tr>';
                
                // Actualizar KPIs con datos reales del endpoint de estad√≠sticas
                if (stats.exito) {
                    const s = stats.estadisticas;
                    document.getElementById('total-cobrado').textContent = '$' + (s.cobrado_mes || 0).toLocaleString();
                    document.getElementById('total-pendiente').textContent = '$' + (s.total_pendiente || 0).toLocaleString();
                    document.getElementById('promedio-ticket').textContent = '$' + (s.promedio_ticket || 0).toLocaleString();
                }
                
            } catch (error) {
                console.error('Error cargando pagos:', error);
            }
        }
        
        // Funci√≥n para cobrar consulta
        async function cobrarConsulta(consultaId) {
            if (confirm('¬øConfirmar cobro de esta consulta?')) {
                try {
                    const res = await fetch(`${API_URL}/api/consultas/${consultaId}/cobrar`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ metodo_pago: 'Efectivo' })
                    });
                    const data = await res.json();
                    if (data.exito) {
                        alert('‚úÖ Consulta cobrada exitosamente');
                        cargarPagos();
                        cargarDashboard();
                    } else {
                        alert('Error: ' + (data.error || 'No se pudo cobrar'));
                    }
                } catch (error) {
                    alert('Error de conexi√≥n');
                }
            }
        }
        
        // Stock
        async function cargarStock() {
            try {
                const res = await fetch(`${API_URL}/api/admin/alertas-stock`);
                const data = await res.json();
                
                if (data.exito) {
                    const r = data.alertas.resumen;
                    document.getElementById('stock-agotados').textContent = r.agotados;
                    document.getElementById('stock-bajo').textContent = r.stock_bajo;
                    document.getElementById('stock-vencidos').textContent = r.vencidos;
                    document.getElementById('stock-por-vencer').textContent = r.por_vencer;
                    
                    document.getElementById('lista-agotados').innerHTML = data.alertas.agotados.slice(0, 8).map(p => `
                        <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--gray-100);">
                            <span style="font-size: 0.85rem;">${p.nombre.substring(0, 35)}...</span>
                            <span class="badge badge-danger">0</span>
                        </div>
                    `).join('') || '<p style="color: var(--gray-500);">Sin productos agotados</p>';
                    
                    document.getElementById('lista-por-vencer').innerHTML = data.alertas.por_vencer.slice(0, 8).map(p => `
                        <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--gray-100);">
                            <span style="font-size: 0.85rem;">${p.nombre.substring(0, 30)}...</span>
                            <span class="badge badge-warning">${p.dias_para_vencer}d</span>
                        </div>
                    `).join('') || '<p style="color: var(--gray-500);">Sin productos por vencer</p>';
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }
        
        // Peluquer√≠a (simulado)
        function cargarPeluqueria() {
            document.getElementById('peluqueria-hoy').textContent = 6;
            document.getElementById('peluqueria-completadas').textContent = 3;
            document.getElementById('peluqueria-espera').textContent = 2;
            document.getElementById('peluqueria-ingresos').textContent = '$' + (85000).toLocaleString();
            
            document.getElementById('tabla-peluqueria').innerHTML = `
                <tr>
                    <td>09:00</td>
                    <td>Max</td>
                    <td>Golden Retriever</td>
                    <td>Juan P√©rez</td>
                    <td>Ba√±o + Corte</td>
                    <td>$25.000</td>
                    <td><span class="badge badge-success">Completado</span></td>
                    <td><button class="btn btn-sm btn-secondary">üëÅÔ∏è</button></td>
                </tr>
                <tr>
                    <td>10:30</td>
                    <td>Luna</td>
                    <td>Poodle</td>
                    <td>Mar√≠a Gonz√°lez</td>
                    <td>Ba√±o + Corte + U√±as</td>
                    <td>$35.000</td>
                    <td><span class="badge badge-success">Completado</span></td>
                    <td><button class="btn btn-sm btn-secondary">üëÅÔ∏è</button></td>
                </tr>
                <tr>
                    <td>12:00</td>
                    <td>Rocky</td>
                    <td>Bulldog</td>
                    <td>Carlos L√≥pez</td>
                    <td>Ba√±o</td>
                    <td>$18.000</td>
                    <td><span class="badge badge-info">En proceso</span></td>
                    <td><button class="btn btn-sm btn-secondary">üëÅÔ∏è</button></td>
                </tr>
                <tr>
                    <td>14:00</td>
                    <td>Michi</td>
                    <td>Persa</td>
                    <td>Ana Mart√≠nez</td>
                    <td>Ba√±o + Cepillado</td>
                    <td>$22.000</td>
                    <td><span class="badge badge-warning">En espera</span></td>
                    <td><button class="btn btn-sm btn-secondary">üëÅÔ∏è</button></td>
                </tr>
            `;
        }
        
        // Usuarios
        function cargarUsuarios() {
            document.getElementById('tabla-usuarios').innerHTML = `
                <tr>
                    <td>admin</td>
                    <td>Administrador</td>
                    <td><span class="badge badge-purple">Super Admin</span></td>
                    <td>admin@vetclinic.cl</td>
                    <td>Hace 5 min</td>
                    <td><span class="badge badge-success">Activo</span></td>
                    <td><button class="btn btn-sm btn-secondary">‚úèÔ∏è</button></td>
                </tr>
                <tr>
                    <td>dr.martinez</td>
                    <td>Dr. Mart√≠nez</td>
                    <td><span class="badge badge-info">Veterinario</span></td>
                    <td>martinez@vetclinic.cl</td>
                    <td>Hace 1 hora</td>
                    <td><span class="badge badge-success">Activo</span></td>
                    <td><button class="btn btn-sm btn-secondary">‚úèÔ∏è</button></td>
                </tr>
                <tr>
                    <td>recepcion</td>
                    <td>Recepcionista</td>
                    <td><span class="badge badge-warning">Recepci√≥n</span></td>
                    <td>recepcion@vetclinic.cl</td>
                    <td>Hace 30 min</td>
                    <td><span class="badge badge-success">Activo</span></td>
                    <td><button class="btn btn-sm btn-secondary">‚úèÔ∏è</button></td>
                </tr>
                <tr>
                    <td>inventario</td>
                    <td>Encargada Inventario</td>
                    <td><span class="badge badge-info">Inventario</span></td>
                    <td>inventario@vetclinic.cl</td>
                    <td>Ayer</td>
                    <td><span class="badge badge-success">Activo</span></td>
                    <td><button class="btn btn-sm btn-secondary">‚úèÔ∏è</button></td>
                </tr>
            `;
        }
        
        // Tabs
        function showFichasTab(tab) {
            document.querySelectorAll('#section-fichas .tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
        }
        
        function showAgendaTab(tab) {
            document.querySelectorAll('#section-agenda .tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
        }
        
        function showPagosTab(tab) {
            document.querySelectorAll('#section-pagos .tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
        }
        
        // Modales
        function abrirModalPaciente() {
            document.getElementById('modal-paciente').classList.add('active');
            // Limpiar formulario
            document.querySelectorAll('#modal-paciente input, #modal-paciente select, #modal-paciente textarea').forEach(el => {
                if (el.type === 'select-one') el.selectedIndex = 0;
                else el.value = '';
            });
        }
        
        function abrirModalPeluqueria() {
            document.getElementById('modal-peluqueria').classList.add('active');
            document.getElementById('pelu-fecha').value = new Date().toISOString().split('T')[0];
        }
        
        function cerrarModal(tipo) {
            document.getElementById('modal-' + tipo).classList.remove('active');
        }
        
        // Cargar razas seg√∫n especie
        async function cargarRazas() {
            const especie = document.getElementById('pac-especie').value;
            const selectRaza = document.getElementById('pac-raza');
            
            if (!especie || especie === 'Otro') {
                selectRaza.innerHTML = '<option value="">Sin razas disponibles</option>';
                return;
            }
            
            try {
                const res = await fetch(`${API_URL}/api/razas/${especie.toLowerCase()}`);
                const data = await res.json();
                
                if (data.exito && data.razas) {
                    selectRaza.innerHTML = '<option value="">Seleccionar raza...</option>' +
                        data.razas.map(r => `<option value="${r}">${r}</option>`).join('');
                }
            } catch (error) {
                selectRaza.innerHTML = '<option value="">Error cargando razas</option>';
            }
        }
        
        // Guardar nuevo paciente
        async function guardarPaciente() {
            const nombre = document.getElementById('pac-nombre').value.trim();
            const especie = document.getElementById('pac-especie').value;
            const tutorNombre = document.getElementById('tutor-nombre').value.trim();
            const tutorTelefono = document.getElementById('tutor-telefono').value.trim();
            
            if (!nombre || !especie || !tutorNombre || !tutorTelefono) {
                alert('Por favor complete los campos obligatorios: Nombre, Especie, Nombre del Tutor y Tel√©fono');
                return;
            }
            
            const paciente = {
                nombre: nombre,
                especie: especie,
                raza: document.getElementById('pac-raza').value || '',
                sexo: document.getElementById('pac-sexo').value || '',
                fecha_nacimiento: document.getElementById('pac-nacimiento').value || '',
                color: document.getElementById('pac-color').value || '',
                peso: document.getElementById('pac-peso').value || '',
                microchip: document.getElementById('pac-microchip').value || '',
                alergias: document.getElementById('pac-alergias').value || '',
                tutor: {
                    nombre: tutorNombre,
                    rut: document.getElementById('tutor-rut').value || '',
                    telefono: tutorTelefono,
                    email: document.getElementById('tutor-email').value || '',
                    direccion: document.getElementById('tutor-direccion').value || '',
                    comuna: document.getElementById('tutor-comuna').value || ''
                }
            };
            
            try {
                const res = await fetch(`${API_URL}/api/pacientes`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(paciente)
                });
                
                const data = await res.json();
                
                if (data.exito) {
                    alert('‚úÖ Paciente registrado exitosamente con ID: ' + data.paciente.id);
                    cerrarModal('paciente');
                    cargarPacientes();
                    cargarDashboard();
                } else {
                    alert('‚ùå Error: ' + (data.error || 'No se pudo registrar'));
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error de conexi√≥n al servidor');
            }
        }
        
        function verFicha(id) {
            // Mostrar ficha del paciente
            window.open(`ficha_paciente.html?id=${id}`, '_blank');
        }
        
        function buscarPacientes() {
            const termino = document.getElementById('buscar-paciente').value.toLowerCase();
            const especie = document.getElementById('filtro-especie').value;
            cargarPacientes(termino, especie);
        }
        
        // Cargar pacientes con filtros
        async function cargarPacientesConFiltro() {
            const termino = document.getElementById('buscar-paciente').value.toLowerCase();
            const especie = document.getElementById('filtro-especie').value;
            
            try {
                const res = await fetch(`${API_URL}/api/pacientes`);
                const data = await res.json();
                
                if (data.exito) {
                    let pacientes = data.pacientes;
                    
                    // Filtrar por t√©rmino de b√∫squeda
                    if (termino) {
                        pacientes = pacientes.filter(p => 
                            p.nombre.toLowerCase().includes(termino) ||
                            (p.tutor?.nombre || '').toLowerCase().includes(termino) ||
                            (p.raza || '').toLowerCase().includes(termino)
                        );
                    }
                    
                    // Filtrar por especie
                    if (especie) {
                        pacientes = pacientes.filter(p => p.especie === especie);
                    }
                    
                    renderizarTablaPacientes(pacientes);
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }
        
        function renderizarTablaPacientes(pacientes) {
            const tbody = document.getElementById('tabla-pacientes');
            tbody.innerHTML = pacientes.map(p => `
                <tr>
                    <td>
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                            <div class="avatar" style="background: ${p.especie === 'Perro' ? '#dbeafe' : '#fce7f3'}">
                                ${p.especie === 'Perro' ? 'üêï' : p.especie === 'Gato' ? 'üêà' : 'üêæ'}
                            </div>
                            <div>
                                <strong>${p.nombre}</strong>
                                <br><small style="color: var(--gray-500);">ID: ${p.id}</small>
                            </div>
                        </div>
                    </td>
                    <td>${p.especie}<br><small style="color: var(--gray-500);">${p.raza || 'Sin especificar'}</small></td>
                    <td>${p.tutor?.nombre || 'Sin tutor'}<br><small style="color: var(--gray-500);">${p.tutor?.telefono || ''}</small></td>
                    <td>${p.edad || calcularEdad(p.fecha_nacimiento) || 'N/A'}</td>
                    <td>${p.ultima_visita || 'Sin visitas'}</td>
                    <td><span class="badge ${p.fallecido ? 'badge-danger' : 'badge-success'}">${p.fallecido ? 'Fallecido' : 'Activo'}</span></td>
                    <td>
                        <button class="btn btn-sm btn-secondary" onclick="verFicha(${p.id})">üëÅÔ∏è Ver</button>
                    </td>
                </tr>
            `).join('') || '<tr><td colspan="7" style="text-align: center; color: var(--gray-500);">No hay pacientes</td></tr>';
            
            document.getElementById('info-pacientes').textContent = `Total: ${pacientes.length} pacientes`;
        }
        
        function calcularEdad(fechaNacimiento) {
            if (!fechaNacimiento) return '';
            const hoy = new Date();
            const nacimiento = new Date(fechaNacimiento);
            let edad = hoy.getFullYear() - nacimiento.getFullYear();
            const mes = hoy.getMonth() - nacimiento.getMonth();
            if (mes < 0 || (mes === 0 && hoy.getDate() < nacimiento.getDate())) edad--;
            
            if (edad < 1) {
                const meses = (hoy.getMonth() + 12 - nacimiento.getMonth()) % 12;
                return meses + ' meses';
            }
            return edad + ' a√±os';
        }
        
        function buscarTutores() {
            cargarTutores();
        }
        
        function logout() {
            localStorage.removeItem('vetclinic_user');
            window.location.href = 'login.html';
        }
        
        // Cargar consultas historial
        async function cargarConsultasHistorial() {
            try {
                const res = await fetch(`${API_URL}/api/consultas/todas`);
                const data = await res.json();
                
                const tbody = document.getElementById('tabla-consultas-historial');
                if (data.exito && data.consultas) {
                    tbody.innerHTML = data.consultas.slice(0, 50).map(c => {
                        const fecha = c.fecha_registro ? new Date(c.fecha_registro).toLocaleDateString('es-CL') : 'N/A';
                        const pagado = c.cobro?.pagado;
                        return `
                            <tr>
                                <td>${fecha}</td>
                                <td>${c.paciente?.nombre || 'N/A'}</td>
                                <td>${c.diagnostico?.nombre || c.motivo_consulta || 'Sin diagn√≥stico'}</td>
                                <td>${c.atendido_por || 'N/A'}</td>
                                <td>$${(c.cobro?.total || 0).toLocaleString()}</td>
                                <td><span class="badge ${pagado ? 'badge-success' : 'badge-warning'}">${pagado ? 'Pagado' : 'Pendiente'}</span></td>
                                <td><button class="btn btn-sm btn-secondary">üëÅÔ∏è</button></td>
                            </tr>
                        `;
                    }).join('');
                } else {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">No hay consultas</td></tr>';
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }
        
        // Cargar agenda con consultas reales
        async function cargarAgenda() {
            try {
                const res = await fetch(`${API_URL}/api/consultas/pendientes`);
                const data = await res.json();
                
                const tbody = document.getElementById('tabla-agenda');
                if (data.exito && data.consultas) {
                    tbody.innerHTML = data.consultas.map(c => {
                        const hora = c.fecha_registro ? new Date(c.fecha_registro).toLocaleTimeString('es-CL', {hour: '2-digit', minute: '2-digit'}) : 'N/A';
                        return `
                            <tr>
                                <td><strong>${hora}</strong></td>
                                <td>${c.paciente?.nombre || 'N/A'}</td>
                                <td>${c.paciente?.propietario || 'N/A'}</td>
                                <td><span class="badge badge-info">${c.tipo_consulta || 'General'}</span></td>
                                <td>${c.atendido_por || 'Sin asignar'}</td>
                                <td><span class="badge badge-warning">${c.estado}</span></td>
                                <td><button class="btn btn-sm btn-secondary">üëÅÔ∏è</button></td>
                            </tr>
                        `;
                    }).join('');
                } else {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">No hay citas pendientes</td></tr>';
                }
                
                // Tambi√©n actualizar pr√≥ximas citas en dashboard
                actualizarProximasCitas(data.consultas || []);
            } catch (error) {
                console.error('Error:', error);
            }
        }
        
        function actualizarProximasCitas(consultas) {
            const container = document.getElementById('proximas-citas');
            if (consultas.length === 0) {
                container.innerHTML = '<p style="color: var(--gray-500); text-align: center;">No hay citas pendientes hoy</p>';
                return;
            }
            
            container.innerHTML = consultas.slice(0, 5).map(c => {
                const hora = c.fecha_registro ? new Date(c.fecha_registro).toLocaleTimeString('es-CL', {hour: '2-digit', minute: '2-digit'}) : 'N/A';
                return `
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--gray-100);">
                        <div><strong>${hora}</strong> - ${c.paciente?.nombre || 'Paciente'} (${c.tipo_consulta || 'Consulta'})</div>
                        <span class="badge badge-warning">En espera</span>
                    </div>
                `;
            }).join('');
        }
        
        // Init
        cargarDashboard();
    </script>
</body>
</html>


